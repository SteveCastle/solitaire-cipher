<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Solitaire Cipher</title>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
    <link rel="stylesheet" href="css/cards.css" />
	<style>
.card{
	width:62px;
	height:90px;
	position:relative;
	margin:5px;
	float:left;
    background-size:100%;
    color:red;
}
	</style>
</head>
<body>
	<div class="cards"></div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
	<script>
    var CardDeck ={
    	order: [],
    	init: function(){
    		for(var i=1;i<=54;i++){
    			this.order.push(i);
    		}
    		this.order = this.shuffle(this.order);
    		this.draw();
    	},
        shuffle: function shuffle(o){ //v1.0
        	if(!o){
        		o = this.order;
        	}
            for(var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
            	this.draw();
            return o;
},
        cycle_a: function(order){
            var a_joker,b_joker,difference,top_set,bottom_set,middle_set;
            a_joker = this.order.indexOf(53);
            b_joker = this.order.indexOf(54);
            //Step One: Swap A Joker with the Card Below It
            if(a_joker<53){
                swap = this.order[a_joker+1];
                this.order[a_joker+1] = 53;
                this.order[a_joker] = swap;
            }
            else{
                difference = a_joker - 53;
                swap = this.order[difference];
                this.order[difference] = 53;
                this.order[a_joker] = swap;
            }
            console.log(this.order);
            this.draw();
        },
        cycle_b: function(order){
            //Step Two: Swap B Joker with the Card Two Below It
            a_joker = this.order.indexOf(53);
            b_joker = this.order.indexOf(54);
            if(b_joker<52){
                swap = this.order[b_joker+2];
                this.order[b_joker+2] = 54;
                this.order[b_joker] = swap;
            }
            else{
                difference = (b_joker-53);
                swap = this.order[difference+1];
                this.order[difference+1] = 54;
                this.order[b_joker] = swap;
            }
            console.log(this.order);
            this.draw();
        },
        tripple_cut: function(){
            //Step Three: Triple Cut Cards Above Top Joker and Below Bottom Joker
            a_joker = this.order.indexOf(53);
            b_joker = this.order.indexOf(54);
            if(a_joker>b_joker){
                top_set = this.order.slice(0,b_joker);
                bottom_set = this.order.slice(a_joker+1);
                middle_set = this.order.slice(b_joker,a_joker+1);
            }
            else{
            top_set = this.order.slice(0,a_joker);
            bottom_set = this.order.slice(b_joker+1);
            middle_set = this.order.slice(a_joker,b_joker+1);
            }
            this.order.length = 0;
            this.order = bottom_set.concat(middle_set,top_set);
            console.log(this.order);
            this.draw();
        },
        find_key: function(){
        var top_card = this.order[0];
        return this.order[top_card+2];
        },
        count_cut: function(){
            //Step Four- Find number of the bottom card, count down this many cards from the top and cut to the bottom, but above the last card. 
            bottom_card = this.order[53];
            if(bottom_card<53){
            top_set = this.order.slice(0,bottom_card);
            middle_set = this.order.slice(bottom_card,53);
            console.log(bottom_card,top_set,middle_set);
            this.order.length = 0;
            this.order = middle_set.concat(top_set,bottom_card);
            }
            console.log(this.order,this.order.length);
            this.draw();
  
        },

        get_character: function(order){
            this.cycle_a();

            this.cycle_b();
            this.tripple_cut();   
            this.count_cut(); 
            keystreamChar = this.find_key();
            if (keystreamChar<53){
            return keystreamChar;
            }else{
                return null;
            }

        },
        draw: function(){
        	$('.cards').empty();
            _.each(this.order,function(card){
            $('.cards').append("<div class='card "+ CardDeck.get_suit_and_rank(card).rank+CardDeck.get_suit_and_rank(card).suit+ "'data-card=''></div>")
            });
        },
        get_suit_and_rank: function(card){
        	var suit,rank,rank_position;
        	var ranks = ["ace","two","three","four","five","six","seven","eight","nine","ten","jack","queen","king"];
        	if(card>52){return {rank:"joker", suit:card}}
        		else{
        			rank_position = (card-1)%13;
        			rank = ranks[rank_position]
        		}
            if(card<=13){
            	suit = "clubs"
            }
            else if(card>=14 && card<=26){
            	suit = "diamonds"
            }
            else if(card>=27 && card<=39){
                suit = "hearts"
            }
            else{
                suit = "spades"
            }
        	return{suit:suit,rank:rank}
        },
        stream: function(){
            for(var i =0;i<1000;i++)
            this.get_character();
        }

    }

    $(document).ready(function(){
        CardDeck.init();
    });
	</script>
</body>
</html>